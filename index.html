<!DOCTYPE html>
<html>
  <head>
    <title>Pong</title>
    <script language="javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" type="text/javascript"></script><script language="javascript" src="js/jquery.hotkeys.js" type="text/javascript"></script><script language="javascript" src="js/key_status.js" type="text/javascript"></script><script language="javascript" src="js/util.js" type="text/javascript"></script>
  </head>
  <body>
    <script type='text/javascript'>
      //<![CDATA[
        var CANVAS_WIDTH = 800;
        var CANVAS_HEIGHT = 600;
        var FPS = 60;
                
        var leftPaddle = { 
          color: "#fff",
          x: 5,
          y: 270,
          width: 10,
          height: 60,
          
          draw: function(){
            context.fillStyle = this.color;
            context.fillRect(this.x, this.y, this.width, this.height);
          }
        }

        var rightPaddle = {
          color: "#fff",
          x: 785,
          y: 270,
          width: 10,
          height: 60,

          draw: function(){
            context.fillStyle = this.color;
            context.fillRect(this.x, this.y, this.width, this.height);
          }

        }

        var ball = {
          color: "#fff",
          x: 200,
          y: 300,
          radius: 5,
          angle: 2*3.14159,

          update: function(){
            this.x += Math.cos(this.angle) * 10;
            this.y += Math.sin(this.angle) * 10;

            if (this.y - this.radius < 0) {
              this.angle = - this.angle;
              this.y = this.radius + 0.1;
            }
            if (this.y + this.radius > CANVAS_HEIGHT) {
              this.angle = - this.angle;
              this.y - this.radius - 0.1;
            }
            if (this.x - this.radius < leftPaddle.x + leftPaddle.width  &&
                this.x - this.radius > leftPaddle.x &&
                this.y + this.radius >= leftPaddle.y &&
                this.y - this.radius <= leftPaddle.y + leftPaddle.height) 
            {
              this.angle = 3.14159 - this.angle - 0.16 + Math.floor( Math.random() * 0.32 );
              this.x = leftPaddle.x + this.radius + 1;
            }

            if (this.x + this.radius > rightPaddle.x - rightPaddle.width &&
                this.x + this.radius < rightPaddle.x &&
                this.y + this.radius >= rightPaddle.y &&
                this.y - this.radius <= rightPaddle.y + rightPaddle.height)
            {
              this.angle = 3.14159 - this.angle - 0.16 + Math.floor( Math.random() * 0.32 );
              this.x = rightPaddle.x - this.radius - 1;
            }


          },

          draw: function(){
            context.fillStyle = this.color;
            context.arc(this.x, this.y, this.radius, 0, 2 * Math.PI, false);
            context.fill();
          }

        }
                        
        var canvas = $("<canvas width='" + CANVAS_WIDTH + 
          "' height='" + CANVAS_HEIGHT + "'></canvas");
        
        var context = canvas.get(0).getContext('2d');   

        canvas.appendTo('body');
        
        setInterval(function() {
          update();
          draw();
        }, 1000/FPS);
        
        function update() {        
          if(keydown.down) {
            leftPaddle.y += 5;
          }
        
          if(keydown.up) {
            leftPaddle.y -= 5;
          }
        
          leftPaddle.y = leftPaddle.y.clamp(5, CANVAS_HEIGHT - leftPaddle.height - 5);  

          ball.update();                
        }
                
        function draw() {
          context.beginPath();

          context.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

          context.fillStyle = "#000";
          context.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT)

          leftPaddle.draw();
          ball.draw();
          rightPaddle.draw();
        }               
      //]]>
    </script>
  </body>
</html>
